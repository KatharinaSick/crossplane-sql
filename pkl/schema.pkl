amends "goTemplate.pkl"

step = "schema"
templateVar = """
    {{ range .observed.composite.resource.spec.parameters.schemas }}
    ---
    apiVersion: kubernetes.crossplane.io/v1alpha2
    kind: Object
    metadata:
      name: {{ $.observed.composite.resource.spec.id }}-schema-{{ .database }}
      annotations:
        gotemplating.fn.crossplane.io/composition-resource-name: {{ $.observed.composite.resource.spec.id }}-schema-{{ .database }}
    spec:
      providerConfigRef:
        name: {{ $.observed.composite.resource.spec.id }}-sql
      forProvider:
        manifest:
          apiVersion: db.atlasgo.io/v1alpha1
          kind: AtlasSchema
          metadata:
            name: {{ $.observed.composite.resource.spec.id }}-{{ .database }}
            namespace: {{ $.observed.composite.resource.spec.claimRef.namespace }}
          toFieldPath: spec.credentials.connectionSecretRef.namespace
          spec:
            credentials:
              scheme: postgres
              hostFrom:
                secretKeyRef:
                  key: endpoint
                  name: {{ $.observed.composite.resource.spec.id }}
              port: 5432
              userFrom:
                secretKeyRef:
                  key: username
                  name: {{ $.observed.composite.resource.spec.id }}
              passwordFrom:
                secretKeyRef:
                  key: password
                  name: {{ $.observed.composite.resource.spec.id }}
              database: {{ .database }}
              parameters:
                sslmode: disable
            schema: 
              sql: "{{ .sql }}"
    {{ end }}
    """