amends "goTemplate.pkl"

step = "dapr-components"
templateVar = """
    {{ if and .observed.composite.resource.spec.parameters.secrets.daprComponents .observed.composite.resource.spec.parameters.secrets.pullToCluster }}
    {{ range .observed.composite.resource.spec.parameters.databases }}
    ---
    apiVersion: kubernetes.crossplane.io/v1alpha2
    kind: Object
    metadata:
      name: {{ $.observed.composite.resource.spec.id }}-dapr-component-{{ . }}
      annotations:
        gotemplating.fn.crossplane.io/composition-resource-name: {{ $.observed.composite.resource.spec.id }}-dapr-component-{{ . }}
    spec:
      providerConfigRef:
        name: {{ $.observed.composite.resource.spec.parameters.secrets.pullToCluster }}
      forProvider:
        manifest:
          apiVersion: dapr.io/v1alpha1
          kind: Component
          metadata:
            name: {{ $.observed.composite.resource.spec.id }}-{{ . }}
            namespace: {{ $.observed.composite.resource.spec.parameters.secrets.pullToClusterNamespace }}
          spec:
            type: state.postgresql
            version: v1
            metadata:
              - name: connectionString
                secretKeyRef:
                  name: {{ $.observed.composite.resource.spec.id }}
                  key: conn-{{ . }}
    {{ end }}
    {{ end }}
    """
