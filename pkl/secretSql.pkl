hidden userFromApi:     String
hidden userFromKind:    String
hidden userFromPath:    String = "metadata.name"
hidden addressFromApi:  String
hidden addressFromKind: String
hidden addressFromPath: String

name = "sql-secret"
base {
    apiVersion = "kubernetes.crossplane.io/v1alpha2"
    kind = "Object"
    spec {
        references {
            new {
                patchesFrom {
                    apiVersion = userFromApi
                    kind       = userFromKind
                    namespace  = "crossplane-system"
                    fieldPath  = userFromPath
                }
                toFieldPath = "stringData.username"
            }
            new {
                patchesFrom {
                    apiVersion = "v1"
                    kind       = "Secret"
                    namespace  = "crossplane-system"
                    fieldPath  = "data.password"
                }
                toFieldPath = "data.password"
            
            }
            new {
                patchesFrom {
                    apiVersion = addressFromApi
                    kind       = addressFromKind
                    namespace  = "crossplane-system"
                    fieldPath  = addressFromPath
                }
                toFieldPath = "stringData.endpoint"
            }
        }
        forProvider {
            manifest {
                apiVersion = "v1"
                kind = "Secret"
                metadata {
                    namespace = "crossplane-system"
                }
                data {
                    port = "NTQzMg=="
                }
            }
        }
    }
}
patches {
    new {
        fromFieldPath = "metadata.annotations"
        toFieldPath = "metadata.annotations"
    }
    new {
        fromFieldPath = "spec.id"
        toFieldPath = "metadata.name"
        transforms { new {
            type = "string"
            string {
                fmt = "%s-secret"
                type = "Format"
            }
        } }
    }
    new {
        fromFieldPath = "spec.id"
        toFieldPath = "spec.references[0].patchesFrom.name"
    }
    new {
        fromFieldPath = "spec.id"
        toFieldPath = "spec.references[1].patchesFrom.name"
        transforms { new {
            type = "string"
            string {
                fmt = "%s-password"
                type = "Format"
            }
        } }
    }
    new {
        fromFieldPath = "spec.claimRef.namespace"
        toFieldPath = "spec.references[1].patchesFrom.namespace"
    }
    new {
        fromFieldPath = "spec.id"
        toFieldPath = "spec.references[2].patchesFrom.name"
    }
    new {
        fromFieldPath = "spec.id"
        toFieldPath = "spec.forProvider.manifest.metadata.name"
    }
    new {
        fromFieldPath = "spec.id"
        toFieldPath = "spec.providerConfigRef.name"
        transforms { new {
            type = "string"
            string {
                fmt = "%s-sql"
                type = "Format"
            }
        } }
    }
    new {
        fromFieldPath = "spec.claimRef.namespace"
        toFieldPath = "spec.forProvider.manifest.metadata.namespace"
    }
}
