amends "goTemplate.pkl"

step = "secret-pull-cluster"
templateVar = """
    {{ if and .observed.composite.resource.spec.parameters.secrets.storeName .observed.composite.resource.spec.parameters.secrets.pullToCluster }}
    ---
    apiVersion: kubernetes.crossplane.io/v1alpha2
    kind: Object
    metadata:
      name: {{ $.observed.composite.resource.spec.id }}-secret-pull-cluster
      annotations:
        gotemplating.fn.crossplane.io/composition-resource-name: {{ $.observed.composite.resource.spec.id }}-secret-pull-cluster
    spec:
      providerConfigRef:
        name: {{ $.observed.composite.resource.spec.parameters.secrets.pullToCluster }}
      forProvider:
        manifest:
          metadata:
            name: {{ $.observed.composite.resource.spec.id }}
            namespace: {{ $.observed.composite.resource.spec.parameters.secrets.pullToClusterNamespace }}
          apiVersion: external-secrets.io/v1beta1
          kind: ExternalSecret
          spec:
            dataFrom:
            - extract:
                conversionStrategy: Default
                decodingStrategy: None
                key: {{ $.observed.composite.resource.spec.id }}
                metadataPolicy: None
            refreshInterval: 1h
            secretStoreRef:
              kind: ClusterSecretStore
              name: {{ $.observed.composite.resource.spec.parameters.secrets.storeName }}
            target:
              creationPolicy: Owner
              deletionPolicy: Retain
              name: {{ $.observed.composite.resource.spec.id }}
    {{ end }}
    """